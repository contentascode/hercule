{"version":3,"sources":["../src/trim-stream.js"],"names":[],"mappings":";;;;;kBAYwB;;AAZxB;;;;;;;;;;;;;;;;AAYe,SAAS,UAAT,GAAsB;AACnC,MAAI,cAAc,EAAd,CAD+B;;AAGnC,WAAS,SAAT,CAAmB,KAAnB,EAA0B,QAA1B,EAAoC,EAApC,EAAwC;AACtC,QAAM,QAAQ,MAAM,QAAN,CAAe,MAAf,CAAR;;;AADgC,eAItC,GAAc,YAAY,MAAZ,CAAmB,KAAnB,CAAd;;;AAJsC,QAOhC,SAAS,YAAY,KAAZ,CAAkB,CAAlB,EAAqB,CAAC,CAAD,CAA9B,CAPgC;AAQtC,kBAAc,YAAY,KAAZ,CAAkB,CAAC,CAAD,CAAhC,CARsC;;AAUtC,SAAK,IAAL,CAAU,MAAV,EAVsC;AAWtC,WAAO,IAAP,CAXsC;GAAxC;;AAeA,WAAS,KAAT,CAAe,EAAf,EAAmB;;AAEjB,QAAI,gBAAgB,EAAhB,EAAoB;AACtB,oBAAc,YAAY,OAAZ,CAAoB,KAApB,EAA2B,EAA3B,CAAd,CADsB;AAEtB,WAAK,IAAL,CAAU,WAAV,EAFsB;KAAxB;;AAKA,SAAK,IAAL,CAAU,IAAV,EAPiB;AAQjB,WAAO,IAAP,CARiB;GAAnB;;AAWA,SAAO,kBAAS,GAAT,CAAa,SAAb,EAAwB,KAAxB,CAAP,CA7BmC;CAAtB","file":"trim-stream.js","sourcesContent":["import through2 from 'through2';\n\n/**\n* Trims new line at EOF to allow a file to be transcluded inline.\n* Multiple transclusions immediately before the end of file can also\n* result excessive new lines accumulating.\n*\n* Input stream: (string)\n*\n* Output stream: (string)\n*/\n\nexport default function TrimStream() {\n  let inputBuffer = '';\n\n  function transform(chunk, encoding, cb) {\n    const input = chunk.toString('utf8');\n\n    // Combine buffer and new input\n    inputBuffer = inputBuffer.concat(input);\n\n    // Return everything but the last character\n    const output = inputBuffer.slice(0, -1);\n    inputBuffer = inputBuffer.slice(-1);\n\n    this.push(output);\n    return cb();\n  }\n\n\n  function flush(cb) {\n    // Empty internal buffer and signal the end of the output stream.\n    if (inputBuffer !== '') {\n      inputBuffer = inputBuffer.replace(/\\n$/, '');\n      this.push(inputBuffer);\n    }\n\n    this.push(null);\n    return cb();\n  }\n\n  return through2.obj(transform, flush);\n}\n"]}