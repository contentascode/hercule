{"version":3,"sources":["../src/hercule.js"],"names":["resolveHttpUrl","resolveLocalUrl","resolveString","TranscludeStream","transcludeString","transcludeFile","source","options","outputFile","get","sourceMap","transclude","indenter","header","trim","sourcemap","stringify","on","end","generatedSourceMap","pipe","transcluder","bubbleErrors","emit","args","input","shift","cb","pop","srcmap","write","then","output","catch","err","bufferedData","inputStream","createReadStream","encoding"],"mappings":"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","file":"hercule.js","sourcesContent":["import fs from 'fs';\nimport _ from 'lodash';\nimport duplexer from 'duplexer3';\nimport get from 'through2-get';\nimport getStream from 'get-stream';\n\nimport Transclude from './transclude';\nimport Indent from './indent';\nimport Header from './header';\nimport Trim from './trim';\nimport Sourcemap from './sourcemap';\n\nexport { resolveHttpUrl, resolveLocalUrl, resolveString } from './resolver';\n\nexport function TranscludeStream(source = 'input', options) {\n  const outputFile = _.get(options, 'outputFile');\n  let sourceMap;\n\n  const transclude = new Transclude(source, options);\n  const indenter = new Indent();\n  const header = new Header();\n  const trim = new Trim();\n  const sourcemap = new Sourcemap(outputFile);\n  const stringify = get('content');\n\n  transclude.on('error', () => transclude.end());\n  sourcemap.on(\n    'sourcemap',\n    generatedSourceMap => (sourceMap = generatedSourceMap)\n  );\n\n  transclude\n    .pipe(trim)\n    .pipe(indenter)\n    .pipe(header)\n    .pipe(sourcemap)\n    .pipe(stringify);\n\n  const transcluder = duplexer({ bubbleErrors: false }, transclude, stringify);\n  transcluder.on('end', () => transcluder.emit('sourcemap', sourceMap));\n\n  return transcluder;\n}\n\nexport function transcludeString(...args) {\n  const input = args.shift();\n  const cb = args.pop();\n  const [options = {}] = args;\n  const source = _.get(options, 'source') || 'string';\n\n  const transclude = new TranscludeStream(source, options);\n  let sourceMap;\n\n  transclude.on('sourcemap', srcmap => (sourceMap = srcmap));\n  transclude.write(input, 'utf8');\n  transclude.end();\n\n  getStream(transclude)\n    .then(output => cb(null, output, sourceMap))\n    .catch(err => cb(err, err.bufferedData, sourceMap));\n}\n\nexport function transcludeFile(...args) {\n  const input = args.shift();\n  const cb = args.pop();\n  const [options = {}] = args;\n\n  const transclude = new TranscludeStream(input, options);\n  const inputStream = fs.createReadStream(input, { encoding: 'utf8' });\n  let sourceMap;\n\n  transclude.on('sourcemap', srcmap => (sourceMap = srcmap));\n  inputStream.on('error', err => cb(err));\n  inputStream.pipe(transclude);\n\n  getStream(transclude)\n    .then(output => cb(null, output, sourceMap))\n    .catch(err => cb(err, err.bufferedData, sourceMap));\n}\n"]}